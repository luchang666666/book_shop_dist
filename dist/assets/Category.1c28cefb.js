import{_ as e}from"./NavBar.cc4d1581.js";import{n as a,p as l,i as t,q as o,s,v as i,x as n,r as c,o as d,e as u,f as r,w as p,F as v,k as m,l as g,y as f,z as b}from"./vendor.59df9684.js";import{r as h}from"./index.31d9e266.js";import{_ as k,B as _}from"./better-scroll.esm.c2643e1f.js";function y(e="sales",a=0,l=1){return h({url:"/api/goods?category_id="+a+"&page="+l+"&"+e+"=1"})}const C={name:"Category",components:{NavBar:e,BackTop:k},setup(){const e=a(1),c=a("1"),d=a(0),u=a([]);let r=a(!1),p=a(null),v=l({}),m=a("sales");const g=a(0),f=t(),b=l({sales:{page:1,list:[]},price:{page:1,list:[]},comments_count:{page:1,list:[]}}),k=o((()=>b[m.value].list)),C=()=>{y("sales",g.value).then((e=>{b.sales.list=e.goods.data})),y("price",g.value).then((e=>{b.price.list=e.goods.data})),y("comments_count",g.value).then((e=>{b.comments_count.list=e.goods.data}))};s((()=>{h({url:"/api/goods"}).then((e=>{u.value=e.categories})),y("sales",g.value).then((e=>{b.sales.list=e.goods.data}));let e=document.querySelector(".wrapper");v=new _(e,{probeType:3,click:!0,pullUpLoad:!0}),v.on("scroll",(e=>{r.value=-e.y>p.value.offsetHeight})),v.on("pullingUp",(()=>{const e=b[m.value].page+1;y(m.value,g.value,e).then((e=>{b[m.value].list.push(...e.goods.data),b[m.value].page+=1})),v.finishPullUp(),console.log("页数",b[m.value].page,"类型",m.value),v.refresh()}))})),i((()=>{n((()=>{v&&v.refresh()}))}));return{activeKey:e,category_list:u,activeName:c,active:d,tabClick:e=>{console.log(e);m.value=["sales","price","comments_count"][e],y(m.value,g.value).then((e=>{b[m.value].list=e.goods.data}))},curOrder:m,curId:g,getGoods:e=>{g.value=e,C()},showGoods:k,goods:b,init:C,bscroll:v,bTop:()=>{v.scrollTo(0,0,500)},isTabFixed:r,banref:p,itemClick:e=>{f.push({path:"/detail",query:{id:e}})}}}},T=b("分类页面"),V={id:"mainbox"},w={class:"ordertab"},x={ref:"banref",class:"goodslist"},B={class:"wrapper"},U={class:"content"};C.render=function(e,a,l,t,o,s){const i=c("nav-bar"),n=c("van-tab"),b=c("van-tabs"),h=c("van-sidebar-item"),k=c("van-collapse-item"),_=c("van-collapse"),y=c("van-sidebar"),C=c("van-card"),N=c("back-top");return d(),u("div",null,[r(i,null,{default:p((()=>[T])),_:1}),r("div",V,[r("div",w,[r(b,{modelValue:t.active,"onUpdate:modelValue":a[1]||(a[1]=e=>t.active=e),onClick:t.tabClick},{default:p((()=>[r(n,{title:"销量排序"}),r(n,{title:"价格排序"}),r(n,{title:"评价排序"})])),_:1},8,["modelValue","onClick"])]),r(y,{class:"leftmenu",modelValue:t.activeKey,"onUpdate:modelValue":a[3]||(a[3]=e=>t.activeKey=e)},{default:p((()=>[r(_,{modelValue:t.activeName,"onUpdate:modelValue":a[2]||(a[2]=e=>t.activeName=e),accordion:""},{default:p((()=>[(d(!0),u(v,null,m(t.category_list,(e=>(d(),u(k,{key:e.id,title:e.name},{default:p((()=>[(d(!0),u(v,null,m(e.children,(e=>(d(),u(h,{key:e.id,title:e.name,onClick:a=>t.getGoods(e.id)},null,8,["title","onClick"])))),128))])),_:2},1032,["title"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["modelValue"]),r("div",x,[r("div",B,[r("div",U,[(d(!0),u(v,null,m(t.showGoods,(e=>(d(),u(C,{onClick:a=>t.itemClick(e.id),key:e.id,num:e.collects_count,price:e.price,desc:e.updated_at.slice(0,10),title:e.title,thumb:e.cover_url},null,8,["onClick","num","price","desc","title","thumb"])))),128))])])],512),g(r(N,{onBTop:t.bTop},null,8,["onBTop"]),[[f,t.isTabFixed]])])])};export default C;
