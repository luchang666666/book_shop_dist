import{_ as e}from"./NavBar.cc4d1581.js";import{i as s,j as l,o as a,e as o,F as n,k as t,f as r,l as i,t as c,m as d,n as u,r as p,w as m,g as b,p as v,q as f,s as g,v as k,x as h,y as w,z as y}from"./vendor.59df9684.js";import{_ as C,B as T}from"./better-scroll.esm.c2643e1f.js";import{_ as x}from"./GoodList.51c28d47.js";import{r as _}from"./index.31d9e266.js";const j={name:"RecommendView",props:{list:{type:Array,default:()=>[]}},setup(){const e=s();return{goD:s=>{e.push({path:"/detail",query:{id:s}})}}}},B={class:"recommend"},F={alt:""};j.render=function(e,s,u,p,m,b){const v=l("lazy");return a(),o("div",B,[(a(!0),o(n,null,t(u.list.slice(0,4),(e=>(a(),o("div",{key:e.id,class:"recommend-item"},[r("a",{href:"",onClick:d((s=>p.goD(e.id)),["prevent"])},[i(r("img",F,null,512),[[v,e.cover_url]]),r("div",null,c(e.description),1)],8,["onClick"])])))),128))])};const G={name:"HomeSwiper",props:{banners:{type:Array,default:()=>[]}},setup:()=>({image:u(["@/assets/images/Welcome.jpg"])})},H={alt:""};G.render=function(e,s,c,d,u,v){const f=p("van-swipe-item"),g=p("van-swipe"),k=l("lazy");return a(),o("div",null,[c.banners.length?(a(),o(g,{key:0,class:"my-swipe",autoplay:3e3,"indicator-color":"white"},{default:m((()=>[(a(!0),o(n,null,t(c.banners,((e,s)=>(a(),o(f,{key:s},{default:m((()=>[i(r("img",H,null,512),[[k,e.img_url]])])),_:2},1024)))),128))])),_:1})):b("v-if",!0)])};const q={name:"TabControl",props:{title:{type:Array,default:()=>[]}},setup(e,s){const l=u(0);return{curIndex:l,itemClick:e=>{l.value=e,s.emit("tabClick",e)}}}},z={class:"tab-control"};function A(e="sales",s=1){return _({url:"/api/index?"+e+"=1&page="+s})}q.render=function(e,s,l,i,d,u){return a(),o("div",z,[(a(!0),o(n,null,t(l.title,((e,s)=>(a(),o("div",{class:["tab-control-item",{active:s==i.curIndex}],key:s,onClick:e=>i.itemClick(s)},[r("span",null,c(e),1)],10,["onClick"])))),128))])};const L={components:{NavBar:e,RecommendView:j,TabControl:q,GoodList:x,BackTop:C,HomeSwiper:G},name:"Home",setup(){const e=u([]),s=v({sales:{list:[],page:1},recommend:{list:[],page:1},new:{list:[],page:1}});let l=u("sales");const a=f((()=>s[l.value].list));let o=v({}),n=u(!1),t=u(null),r=u([]);g((()=>{_({url:"/api/index"}).then((s=>{s&&(e.value=s.goods.data,r.value=s.slides)})),A("sales").then((e=>{s.sales.list=e.goods.data})),A("recommend").then((e=>{s.recommend.list=e.goods.data})),A("new").then((e=>{s.new.list=e.goods.data})),console.log(s);let a=document.querySelector(".wrapper");o=new T(a,{probeType:3,click:!0,pullUpLoad:!0}),o.on("scroll",(e=>{n.value=-e.y-150>t.value.offsetHeight})),o.on("pullingUp",(()=>{const e=s[l.value].page+1;A(l.value,e).then((e=>{s[l.value].list.push(...e.goods.data),s[l.value].page+=1})),o.finishPullUp(),console.log("页数",s[l.value].page,"类型",l.value),o.refresh()}))}));k((()=>{h((()=>{o&&o.refresh()}))}));return{book_list:e,tabClick:e=>{l.value=["sales","new","recommend"][e],h((()=>{o&&o.refresh()}))},goods:s,showGoods:a,bscroll:o,isTabFixed:n,banref:t,bTop:()=>{o.scrollTo(0,0,500)},banners:r}}},S={id:"home"},U=y("首页"),D={class:"wrapper"},I={class:"content"},N={ref:"banref",class:"banners"};L.render=function(e,s,l,n,t,c){const d=p("nav-bar"),u=p("tab-control"),b=p("home-swiper"),v=p("recommend-view"),f=p("good-list"),g=p("back-top");return a(),o("div",S,[r(d,null,{default:m((()=>[U])),_:1}),i(r(u,{onTabClick:n.tabClick,title:["畅销","新书","精选"]},null,8,["onTabClick"]),[[w,n.isTabFixed]]),r("div",D,[r("div",I,[r("div",N,[r(b,{banners:n.banners},null,8,["banners"])],512),r(v,{list:n.book_list},null,8,["list"]),r(u,{onTabClick:n.tabClick,title:["畅销","新书","精选"]},null,8,["onTabClick"]),r(f,{goods:n.showGoods},null,8,["goods"])])]),i(r(g,{onBTop:n.bTop},null,8,["onBTop"]),[[w,n.isTabFixed]])])};export default L;
